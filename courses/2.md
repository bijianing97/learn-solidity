# 第二课

## Remix

[Remix IDE](http://remix.ethereum.org/)

### 编译智能合约

#### 编译面版介绍

![](../img/06.png)

1. 选择编译器版本, 大多是时候 IDE 会根据文件头部的声明自动选择

2. 选择要编译的语言, 默认 Solidity 即可

3. 根据以太坊硬分叉选择 EVM 的版本, 每个硬分叉都为 EVM 增加了新的特性, 如果不是想测试旧版本的 EVM 的话, 默认 default 即可

4. 是否自动编译, 勾选的话, 每次修改完都会自动编译一次

5. 是否启用编译优化以及编译优化等级, 一般选用 200 即可, 优化后的合约部署成本更低

6. 是否忽略警告

7. 编译合约

8. 选择要编译的合约`合约名(文件名.sol)`

9. 查看编译细节, 见[编译细节面板介绍](#编译细节面板介绍)

10. 复制合约 ABI(Application Binary Interface), ABI 是一个很大的 json, 一般用于外部和合约交互

11. 复制合约字节码, 字节码就是合约编译的结果

#### 编译细节面板介绍

![](../img/07.png)

编译细节面板包含诸多细节, 一般只需要关心`FUNCTIONHASHES`, 这就是上一课所说的`function selector`.如果手动与合约交互, 可能会用到这个

### 部署、调试智能合约

#### 部署、调试面版介绍

![](../img/08.png)

1. 选择运行的网络环境

   - JavaScript VM

     使用在浏览器内存中运行的一个虚拟的区块链(每发起一笔交易, 都会为其生成一个新的区块, 但智能合约方面的行为与 EVM 完全一致)作为运行环境. 如果选择此选项, `ACCOUNT`中会自动生成若干个余额为 100 ETH 的账户用于测试

   - Injected Web3

     使用浏览器中的 Web3 插件(一般是 MetaMask)当前的环境作为运行环境. 比如, 如果要链接到 GXChain2.0 的 Testnet, 需要先在 MetaMask 中添加并切换到自定义网络地址, 然后在 Remix 中选择 `Injected Web3`

   - Web3 Provider

     使用手动输入的以太坊节点 RPC 地址作为运行环境, 如 `http://127.0.0.1:8545`

2. 选择调用合约的账户, 点击加号可以增加一个账户(只在`JavaScript VM`时可用)

3. 设置交易的 `GasLimit`, 有时候合约部署失败, 可能是因为这个数值低了, 需要注意

4. 设置交易附带的转账金额及单位, 只有 `payable` 的方法可以接收转账, 如果不是 `payable`, value 必须为 0

5. 选择需要部署的合约`合约名 - 文件名.sol`, 当文件中有多个合约的时候, 请确认合约名字是否是要部署的合约

6. 部署合约到当前的运行环境

7. 如果合约已经部署, 可以填入合约的地址, 并点击`At Address`即可

8. 已部署的合约列表, 可以在此处与合约交互, 见[合约交互面板介绍](#合约交互面板介绍)

   - `🗑️`可以立即清楚所有合约

   - `x`删除指定的合约

   - `📋`复制合约地址

9. 当一笔交易发出后, 可以在命令行查看交易的具体参数

#### 合约交互面板介绍

![](../img/09.png)

1.  黄色按钮代表此方法会修改以太坊状态树, 需要发起一笔交易才能调用

2.  蓝色按钮代表此方法不会修改以太坊状态树, 只需要进行一次`CALL`就可以调用

    - `📋`复制底层调用参数(`function selector` + 调用参数)

3.  `CALL`的返回结果`返回参数下标: 类型: 值`, 只有`CALL`并且方法有返回参数时, 才可以在这里获取返回参数. 发起交易不能获得合约的返回值. 比如有一个函数`function func() external pure returns(uint256, string memory);`, 调用结果可以是

    ```
    0: uint256: 1
    1: string: xxx
    ```
